<?php
	include 'php_files/functions.php';
	session_start();
	clearSessionBools();
	if(isset($_SESSION['usr']) && isset($_SESSION['pswd'])){
		//user logged in proceed
	}else{
		//not logged in, redirect to login
		header("Location: login.html");
		exit();
	}
	
	date_default_timezone_set('America/Chicago');
	if (isset($_GET['ym'])){
		$ym = $_GET['ym'];
	}else {
		$ym = date('Y-m');
	}
	$today = date('Y-m-d', time());
	$timestamp = strtotime($ym,"-01");
	if ($timestamp === false) {
		$timestamp = time();
	}
	$my_title = date('F y', $timestamp);
	$prev = date('Y-m', mktime(0,0,0,date('m', $timestamp)-1,1,date('Y', $timestamp)));
	$next = date('Y-m', mktime(0,0,0,date('m', $timestamp)+1,1,date('Y', $timestamp)));
	
	$day_count = date('t', $timestamp);
	$str = date('w', mktime(0,0,0,date('m', $timestamp),1,date('Y', $timestamp)));
	
	$weeks = array();
	$week = "";
	$week .= str_repeat('<td></td>', $str);
	
	for( $day = 1; $day <= $day_count; $day++, $str++){
		$date = $ym.'-'.$day;
		if($today == $date){
			//add today formatting here
			$week .= '<td>'.$day;
		}else{
		//add count data here
			$week .= '<td>'.$day;
		}
		$week .='</td>';
		
		if ($str % 7 ==6 || $day == $day_count){
			if( $day == $day_count){
				$week .= str_repeat('<td></td>', 6 - ($str % 7));
			}
			$weeks[] = '<tr>'.$week.'</tr>';
			$week = '';
		}		
	}
	
?>
<!DOCTYPE html>
<html>
	<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script rel="text/javascript" src="nano.js"></script>
	</head>
	
<body>
		<div id="navcontainer">
		
			<div id="navbar">
				<div id="imgcontainer">
					<img id="navlogo" src="resources/AELogo2.png" />
				</div>
				<div id="navmenu">
					<div class="navmenuitem">
						<a class="navmenutext" href="php_files/logoff.php">SIGN OUT</a>
					</div>
					<div class="navmenuitem">
						<a class="navmenutext" href="https://accelentertainment.com">BACK TO MAIN SITE</a>
					</div>
					<div class="clear">
					</div>
				</div>
			</div>
			
		</div>
			
		<div id="accountlistcontainer">
			
			<div id="accountswrapper" class="nano" >
				<div class="content">
					<div class="accountrowempty"></div>
					<div id="ar1" class="accountrow" onclick="changeAccount('ar1')">103 East</div>
					<div id="ar2" class="accountrow" onclick="changeAccount('ar2')">Hucks 365</div>
					<div id="ar3" class="accountrow" onclick="changeAccount('ar3')">Bella's Bistro</div>
					<div id="ar4" class="accountrow" onclick="changeAccount('ar4')">Hucks 386</div>
					<div id="ar5" class="accountrow" onclick="changeAccount('ar5')">Henry's Hotdogs</div>
				</div>
			</div>
		</div>

		<div id="maintablecontainer">
			<div class="containerlabel2">
					<button class="contenttablebutton contentbutton" id="b1" onclick="changeTab(event, 'contentreports')">VGT Reports</button>
					<button class="noborderradius contentbutton" id="b2" onclick="changeTab(event, 'contentfoot')">Foot Traffic Data</button>
					<button class="noborderradius contentbutton" id="b3" onclick="changeTab(event, 'contentabsolute')">Absolute Edge Layout</button>
					<button class="norightborder contentbutton" id="b4" onclick="changeTab(event, 'contentsettings')">Settings</button>
			</div>
			<div class="clear">
			</div>
			<div id="contentwelcome"></div>
			<div id="contentreports" class="tabcontent">Linked BI360 Reports show here
			</div>
			<div id="contentfoot" class="tabcontent">
				<h3><a href="?ym=<?php echo $prev; ?>">&lt;</a> <?php echo $my_title; ?> <a href="?ym=<?php echo $next; ?>">&gt;</a></h3>
				<br>
				<table>
					<tr>	
						<th>Su</th>
						<th>Mo</th>
						<th>Tu</th>
						<th>We</th>
						<th>Th</th>
						<th>Fr</th>
						<th>Sa</th>
					</tr>
					<?php
						foreach ($weeks as $week){
							echo $week;
						}
					?>
				</table>
			
			</div>
			<div id="contentabsolute" class="tabcontent">Field Inputs and iframe example window show here
			</div>
			<div id="contentsettings" class="tabcontent">User/Location settings show here
			</div>
		</div>
		<div class="clear">
		</div>
		<script>
			function changeAccount(accDiv){
				var i, accounts,selectedaccount;
				selectedaccount = document.getElementById(accDiv);
				accounts=document.getElementsByClassName("accountrowselected");
				for(i = 0; i<accounts.length; i++){
					accounts[i].className = accounts[i].className.replace("accountrowselected", "accountrow");
				}
				selectedaccount.className = "accountrowselected";
				localStorage.setItem("selectedaccount", accDiv);
			}
		</script>
		<script>
			$(".nano").nanoScroller();
		</script>
		<script>
			function changeTab(evt, divname) {
				var i, tabcontent, tabbuttons;
				tabcontent = document.getElementsByClassName("tabcontent");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
					
				}
				tabbuttons = document.getElementsByClassName("contentbutton");
				for (i = 0; i < tabbuttons.length; i++) {
					tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
				}
				document.getElementById("contentwelcome").style.display = "none";
				document.getElementById(divname).style.display = "block";
				evt.currentTarget.className += " active";
				document.getElementById(divname).className += " active";
				localStorage.setItem("activemenutab",divname);
			}
		</script>
		<script>
			(function pagereload(){
				if(localStorage.getItem("activemenutab")=="contentreports"){
					document.getElementById("contentwelcome").style.display = "none";
					document.getElementById("contentreports").style.display = "block";
					document.getElementById("b1").className += " active";
				}else if(localStorage.getItem("activemenutab")=="contentfoot"){
					document.getElementById("contentwelcome").style.display = "none";
					document.getElementById("contentfoot").style.display = "block";
					document.getElementById("b2").className += " active";
				}else if(localStorage.getItem("activemenutab")=="contentabsolute"){
					document.getElementById("contentwelcome").style.display = "none";
					document.getElementById("contentabsolute").style.display = "block";
					document.getElementById("b3").className += " active";
				}else if(localStorage.getItem("activemenutab")=="contentsettings"){
					document.getElementById("contentwelcome").style.display = "none";
					document.getElementById("contentsettings").style.display = "block";
					document.getElementById("b4").className += " active";
				}
				var sa=localStorage.getItem("selectedaccount")
				if(sa){
					document.getElementById(sa).className = "accountrowselected";
				}
			})();
		</script>
		
		
</body>
</html>